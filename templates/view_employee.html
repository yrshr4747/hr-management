{% extends 'layout.html' %}
{% block body %}
<div class="container">
    <div class="card mb-4">
        <div class="card-header"><h3 class="mb-0">Employee Filters</h3></div>
        <div class="card-body">
            <form id="filterForm" method="POST" action="">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check form-switch mb-2"><input class="form-check-input" type="checkbox" name="cdepartment" id="cdepartment"><label class="form-check-label" for="cdepartment">Filter by Department</label></div>
                        <select class="form-select" name="department"><option selected value="">All Departments</option>{% for dept in depts %}<option value="{{dept}}">{{dept}}</option>{% endfor %}</select>
                    </div>
                    <div class="col-md-6 mb-3">
                        <div class="form-check form-switch mb-2"><input class="form-check-input" type="checkbox" name="cdesignation" id="cdesignation"><label class="form-check-label" for="cdesignation">Filter by Designation</label></div>
                        <select class="form-select" name="designation"><option selected value="">All Designations</option>{% for desig in desigs %}<option value="{{desig}}">{{desig}}</option>{% endfor %}</select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <div class="form-check form-switch mb-2"><input class="form-check-input" type="checkbox" name="cgender" id="cgender"><label class="form-check-label" for="cgender">Filter by Gender</label></div>
                        <select class="form-select" name="gender"><option selected value="">All Genders</option><option value="male">Male</option><option value="female">Female</option><option value="other">Other</option></select>
                    </div>
                    <div class="col-md-6 mb-3">
                         <div class="form-check form-switch mb-2"><input class="form-check-input" type="checkbox" name="ccity" id="ccity"><label class="form-check-label" for="ccity">Filter by City</label></div>
                        <input class="form-control" type="text" name="city" placeholder="Enter City">
                    </div>
                </div>
                <div class="row align-items-center mb-3">
                    <div class="col-auto"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" name="cage" id="cage"><label class="form-check-label" for="cage">Filter by Minimum Age</label></div></div>
                    <div class="col"><input class="form-range" name="age" type="range" value="20" min="18" max="70" id="ageSlider"></div>
                    <div class="col-auto"><span id="ageValue" class="badge bg-secondary fs-6">20</span></div>
                </div>
                <button type="submit" class="btn btn-info">Search</button>
            </form>
        </div>
    </div>
    <h3 class="mt-5">Employee List</h3>
    <div class="table-responsive">
        <table class="table table-striped table-hover align-middle">
            <thead class="table-dark">
                <tr><th>ID</th><th>Name</th><th>Profile</th><th>Admin Status</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for employee in employees %}
                <tr id="row-{{ employee.emp_id }}">
                    <td>{{ employee.emp_id }}</td><td>{{ employee.name }}</td>
                    <td><a href="/profile/{{ employee.emp_id }}" class="btn btn-sm btn-primary">View</a></td>
                    <td>{% if employee.admin >= 1 %}<button class="btn btn-sm btn-warning remove-admin" data-id="{{ employee.emp_id }}">Remove Admin</button>{% else %}<button class="btn btn-sm btn-success make-admin" data-id="{{ employee.emp_id }}">Make Admin</button>{% endif %}</td>
                    <td><button class="btn btn-sm btn-danger delete-employee" data-id="{{ employee.emp_id }}">Delete</button></td>
                </tr>
                {% else %}
                <tr><td colspan="5" class="text-center">No employees found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
<script>
$(document).ready(function() {
    $('#ageSlider').on('input', function() { $('#ageValue').text(this.value); });
    function performAction(url) { if (confirm('Are you sure?')) { $.ajax({ url: url, method: 'POST', success: function() { location.reload(); }, error: function() { alert('An error occurred.'); } }); } }
    $('.make-admin').on('click', function() { performAction('/make_admin/' + $(this).data('id')); });
    $('.remove-admin').on('click', function() { performAction('/remove_admin/' + $(this).data('id')); });
    $('.delete-employee').on('click', function() { performAction('/delete/' + $(this).data('id')); });
});
</script>
{% endblock %}